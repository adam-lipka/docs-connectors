= Salesforce - Studio - Mule 4
ifndef::env-site,env-github[]
include::_attributes.adoc[]
endif::[]
:imagesdir: ../../assets/images/

== Install Salesforce  

. In Anypoint Studio, click the Exchange icon in the Studio task bar.
. Click Login in Anypoint Exchange and supply your Anypoint Platform username and password.
. Search for the Salesforce connector and click Install.
. Follow the prompts to install the connector.

== Configure this Connector

To configure:

. Drag and drop a connector operation to the Studio canvas.
. Click the operation.
. Click the green plus sign to the right of *Connector Configuration*.
. In the Connection field choose one of the following connection types:
+
** <<Basic Username Password>>
** <<OAuth 2.0>>
** <<OAuth JWT>>
** <<OAuth SAML>>
** <<OAuth Username Password>>
+
. For each of connection choices, you can set optional proxy values:
+
** *Host* - Host name of the proxy server.
** *Port* - The port number the proxy server runs on.
** *Username* - The username to log in to the server.
** *Password* - The corresponding password.

After setting the *Global Element Properties* screen, return to the main connector menu and set the <<Connector Property Values>>.

== Basic Username Password

Important fields:

* *Username* (required): Enter the Salesforce username.
* *Password* (required): Enter the corresponding password.
* *Security token*: Enter the corresponding security token.

== OAuth 2.0

Important fields:

* *Display* (required): How to optimize the display: `PAGE` = Full-page authorization screen (default), `POPUP` = Compact dialog optimized for modern web browser popup windows, and `TOUCH` = Mobile-optimized dialog designed for modern smart phones, such as Android and iPhone.
* *Consumer key* (required): The consumer key for the Salesforce connected app. See xref:salesforce-connector-config-topics.adoc#create-consumer-key[Create a Consumer Key].
* *Consumer secret* (required): The consumer secret for the connector to access Salesforce.
* *Listener config* (required): Configuration for the listener, for example, `HTTP_Listener_config`.
* *Callback path* (required): Path for the callback, for example, `/callback`.
* *Authorize path* (required): Path for authorization, for example, `/authorize`.
* *External callback url*: Callback URL, for example, `+http://localhost:8085/callback+`.

== OAuth JWT

Important fields:

* *Consumer key* (required): The consumer key for the Salesforce connected app. See xref:salesforce-connector-config-topics.adoc#create-consumer-key[Create a Consumer Key].
* *Key store* (required): See xref:salesforce-connector-config-topics.adoc#keystoregen[Generate a Keystore File].
* *Store password* (required): The password for the keystore.
* *Principal* (required): The password for the keystore.

== OAuth SAML

Important fields:

* *Consumer key* (required): The consumer key for the Salesforce connected app. See xref:salesforce-connector-config-topics.adoc#create-consumer-key[Create a Consumer Key].
* *Key store* (required): See xref:salesforce-connector-config-topics.adoc#keystoregen[Generate a Keystore File].
* *Store password* (required): The password for the keystore.
* *Principal* (required) The password for the keystore.

== OAuth Username Password

Important fields:

* *Consumer key* (required): The consumer key for the Salesforce connected app. See xref:salesforce-connector-config-topics.adoc#create-consumer-key[Create a Consumer Key].
* *Consumer secret* (required): The consumer secret for the connector to access Salesforce.
* *Username* (required): Enter the Salesforce username.
* *Password* (required): Enter the corresponding password.
* *Security token*: Enter the corresponding security token.

[[propvals]]
== Connector Property Values

The following are four example operations of the many you can set for the Salesforce connector. 
These are the important fields for these example operations: 

Create:

* *Type*: Salesforce object type.
* *Records*: xref:design-center::function-editor-concept.adoc[Function editor expression].

Query:

* *Salesforce query*: Salesforce query to retrieve objects.
* *Parameters*: Values for placeholders in the salesforce query.

Update:

* *Type*:  Salesforce object type.
* *Records*: xref:design-center::function-editor-concept.adoc[Function editor expression] to produce a collection of Salesforce objects to be updated.

Delete:

* *Records To Delete Ids*: xref:design-center::function-editor-concept.adoc[Function editor expression] to produce a collection of Salesforce objects to be deleted.

[[keepalive]]
== Keep a Session Alive

For the Mule 4 Salesforce Connector, you have the option to keep the session alive until it expires by setting the *Disable session invalidation* field to True in the *Global Element Properties* > *General* > *Advanced* tab, or by setting `disableSessionInvalidation="true"` in the XML flow.

The Mule app controls the lifecycle connections. When the app determines that a given connection is not needed anymore, it checks the setting of Disable Session Invalidation. When the setting is False (the default), the connector automatically destroys the connection for the session. To prevent a session from closing in this case, you can set the Disable Session Invalidation field to True or provide a function expression.

Salesforce uses the same session for all your threads, so for example, if your session is active and you log in again, Salesforce uses the existing session instead of creating a new one.

If the *Disable session invalidation* field is set to False, the connector automatically destroys the session after it's no longer needed.

You should keep the session alive when you are working with threads or concurrency in general. Salesforce uses the same session for all your threads (for example, if you have an active session and you log in again, Salesforce uses the existing session instead of creating a new one). To make sure the connection doesn't close when a thread is finished, you should set the *Disable session invalidation* field to True in the Connection section of the connector's global element properties.

image::salesforce/salesforce-disable-session.png[Disable Session Field]

[[apexsets]]
== Apex Settings

You can set Apex REST and SOAP access using Studio or in XML. When you connect to Salesforce, the Salesforce connector gets the names of the Apex classes and methods belonging to them that can be invoked.

All Salesforce connection configurations support these Apex settings:

* *Fetch All Apex SOAP Metadata*- Fetches the metadata of all the Apex SOAP classes. Takes precedence over Apex Class Name settings. 
* *Fetch All Apex REST Metadata* - Fetches the metadata of all the all Apex REST classes. Takes precedence over Apex Class Name settings.
* *Apex Class Names* - List of Apex class names to use for limiting the set of classes you fetch along with the methods they expose. This setting can speed the fetch process if there are a lot of classes that you do not need to fetch.

You can provide Apex settings in Design Center and in Anypoint Studio 7.
See also xref:salesforce-connector-xml-maven.adoc#apexml[Apex XML Settings].

Click the *Apex* tab to choose the settings.

Apex settings values:

* *Fetch All Apex SOAP Metadata* - Fetches the metadata of all the Apex SOAP classes.
* *Fetch All Apex REST Metadata* - Fetches the metadata of all the all Apex REST classes.

Apex Class Names:

The *Expression*, *Edit inline*, or *Bean reference* choices provide these options:

* *None* - No Apex class name is mentioned for DataSense to acquire.
* *From a message* - Lets you specify the class name using an expression.
* *Create object manually* - You can create a list and add class names to the list - only those classes and their methods are acquired by DataSense.

[NOTE]
====
The *Fetch All Apex SOAP Metadata* and *Fetch All Apex REST Metadata* check boxes take precedence over the *Apex Class Names* setting. If these boxes are selected, they fetch all the Apex SOAP metadata or Apex REST metadata regardless of your selection in the Apex Class Names section.
====


== See Also

* https://forums.mulesoft.com[MuleSoft Forum]
* https://support.mulesoft.com/s/knowledge[Knowledge Base Articles]
